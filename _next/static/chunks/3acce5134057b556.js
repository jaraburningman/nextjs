(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31713,e=>{"use strict";var r=e.i(43476),t=e.i(71645),a=e.i(89786),n=e.i(61756);function s(){let{setTitle:e,setDescription:s}=(0,t.useContext)(a.HeaderContext),{detectionIntervalRef:i}=(0,t.useContext)(n.AppContext);(0,t.useEffect)(()=>{e("Facial Expressions ML/AI + Next.js playground"),s("OpenVINO MobileNet-SSD pretrained model + face 68 landmark, recognition and expression models.")},[]);let c=(0,t.useRef)(null),o=(0,t.useRef)(null),l=(0,t.useRef)(null),d=(0,t.useRef)(null),[u,p]=(0,t.useState)([]),[f,h]=(0,t.useState)(!1),[x,m]=(0,t.useState)(!1),w=e=>e.charAt(0).toUpperCase()+e.slice(1),v=async()=>{try{d.current=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),c.current&&(c.current.srcObject=d.current)}catch(e){console.error(e)}};return(0,t.useEffect)(()=>{let e=document.createElement("script");return e.src="./face-api.js",e.defer=!0,e.onload=()=>{h(!0)},document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,t.useEffect)(()=>{f&&c.current&&o.current&&l.current&&(async()=>{try{await Promise.all([window.faceapi.nets.ssdMobilenetv1.loadFromUri("./models"),window.faceapi.nets.faceLandmark68Net.loadFromUri("./models"),window.faceapi.nets.faceRecognitionNet.loadFromUri("./models"),window.faceapi.nets.faceExpressionNet.loadFromUri("./models")]),await v(),m(!0)}catch(e){console.error("Error loading models:",e)}})()},[f]),(0,t.useEffect)(()=>{if(!f||!c.current||!o.current||!l.current)return;let e=c.current;o.current;let r=l.current,t=async()=>{let t=window.faceapi.createCanvasFromMedia(e);return t.getContext("2d",{willReadFrequently:!0}).clearRect(0,0,t.width,t.height),r.append(t),i.current=setInterval(async()=>{let a={width:r.offsetWidth,height:r.offsetHeight};window.faceapi.matchDimensions(t,a);let n=await window.faceapi.detectAllFaces(e).withFaceLandmarks().withFaceDescriptors().withFaceExpressions(),s=window.faceapi.resizeResults(n,a);0===n.length?p([]):(p(s.map(e=>{let r=[],t="",a=0;for(let[n,s]of Object.entries(e.expressions)){let e=w(n),i=Math.round(100*s);r.push({expressionName:e,expressionValue:i}),i>a&&(a=i,t=e)}return{title:t,data:r}})),s.forEach(e=>{let r=new window.faceapi.draw.DrawFaceLandmarksOptions({drawPoints:!0,pointSize:2,pointColor:"white",drawLines:!0,lineColor:"white",lineWidth:1});new window.faceapi.draw.DrawFaceLandmarks(e.landmarks,r).draw(t)}))},40),()=>clearInterval(i.current)};return e.addEventListener("play",t),()=>{e.removeEventListener("play",t)}},[f]),(0,t.useEffect)(()=>()=>{d.current&&d.current.getTracks().forEach(e=>e.stop()),clearInterval(i.current)},[]),(0,r.jsxs)("div",{className:"ex-app-container",children:[(0,r.jsx)("div",{className:"ex-container",children:x?0===u.length?(0,r.jsx)("div",{className:"ex-box",children:"Detecting faces ..."}):(0,r.jsxs)(r.Fragment,{children:[u.map((e,t)=>(0,r.jsx)("div",{className:"ex-box",children:(0,r.jsx)("table",{className:"ex-box-data",children:(0,r.jsx)("tbody",{children:e.data.map((t,a)=>(0,r.jsx)("tr",{children:(0,r.jsx)("td",{children:(0,r.jsx)("span",{style:t.expressionName===e.title?{fontWeight:"bold",color:"#c01f9c"}:{},children:`${t.expressionName} ${t.expressionValue}%`})})},a))})})},t)),1===u.length&&(0,r.jsx)("div",{className:"ex-box ex-ghost",children:(0,r.jsx)("span",{className:"ex-box-person",children:"#2"})})]}):(0,r.jsx)("div",{className:"ex-box",children:"Loading models"})}),(0,r.jsxs)("div",{id:"ex-video",ref:l,children:[(0,r.jsx)("video",{ref:c,width:"100%",autoPlay:!0}),(0,r.jsx)("canvas",{ref:o,style:{display:"none"}})]})]})}function i(){return(0,r.jsx)(s,{})}e.s(["default",()=>i],31713)}]);